# 类加载过程

## 加载

加载过程主要就是三个工作：
- 通过类名获取定义此类的二进制字节流
- 将这个字节流说代表的静态存储结构转化为方法区的的运行时数据结构
- 在内存中生成一个代表这个类的Class对象，作为方法区这个类的各种数据的访问入口

验证
---

验证阶段时类加载过程中较为重要的一步，主要是为了保证jvm的安全性，避免读入进来的文件字  
节流存在恶意代码功能，使得虚拟机崩溃或者被攻击。

### 文件格式验证

文件格式验证主要就是为了验证class文件中是否为正确的规定文件格式，例如魔数、主次版本号等,
更多的需要参看虚拟机源码。

### 元数据验证

主要工作就是验证字节码类描述的信息语义是否正确，保证其能够正确的被虚拟机使用，可能包括
- 是否含有父类
- 是否继承了或实现了其他类或接口，但没有实现其抽象方法或方法
- 是否继承了final修饰的类。。等等

也可以简单理解为主要是对类的信息进行验证

### 字节码验证

较为复杂的一个验证阶段，主要是通过数据流和控制流验证出程序语言是否是合法的、符合逻辑的

不同于上一个阶段中对类元数据验证，该阶段主要针对方法级别的验证，例如参数类型加载是否正确等

### 符号引用验证

该阶段发生在虚拟机将符号引用壮话伟直接引用的时候，这个转化动作将在`连接`的最后阶段（解析）  
发生，符号引用可以看作是对类自身以外的信息机型匹配性校验


对于类加载机制来说，验证阶段非常重要，但非必要，所以所要运行的代码已经验证过多次了，那么可以
选择关闭验证阶段`-Xverify:none`

## 准备

就是为类变量（static修饰）分配内存，并设置初始值，并且这个初始值指的是这个类型的零值，如：

```java
public static int value = 123;
```

这一阶段其值为`0`并不是`123`，赋值阶段实际上是发生在程序被编译之后`初始化阶段`才开始的。

有一种情况比较特殊，就是使用`final`进行修饰。其值在这个阶段就是`123`
```java
public static final int value = 123;
```

## 解析

解析阶段主要就是对常量池中的符号引用替换为直接引用，主要针对的类、接口、字段、类方法、
接口方法、方法类型、方法句柄、调用点限定符等











